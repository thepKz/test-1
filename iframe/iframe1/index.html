<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <title>Tư Liệu Lịch Sử</title>
</head>
<body>
    <div class="imgLoader"></div>

<div class="container">

  <h1 class="title">
    Lịch sử<br>Kháng chiến chống Pháp<br>1858-1930
  </h1>

  <div class="credit">
    * Tư liệu lịch sử kháng chiến
  </div>

  <div class="book">
    <div class="gap"></div>
    <div class="pages">
      <div class="page"></div>
      <div class="page"></div>
      <div class="page"></div>
      <div class="page"></div>
      <div class="page"></div>
      <div class="page"></div>
    </div>
    <div class="flips">
      <div class="flip flip1">
        <div class="flip flip2">
          <div class="flip flip3">
            <div class="flip flip4">
              <div class="flip flip5">
                <div class="flip flip6">
                  <div class="flip flip7"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal để hiển thị ảnh khi click -->
<div id="imageModal" class="modal">
  <span class="close">&times;</span>
  <img class="modal-content" id="modalImage">
</div>

<script>
  // Preload all images before showing content
  const images = [
    '../../img/mockup.jpg',
    '../../img/mockup.jpg',
    '../../img/mockup.jpg',
    '../../img/mockup.jpg',
    '../../img/mockup.jpg'
  ];

  let loadedCount = 0;
  const totalImages = images.length;

  function preloadImage(url) {
    return new Promise((resolve, reject) => {
      const img = new Image();
      img.onload = () => resolve();
      img.onerror = () => resolve(); // Continue even if image fails
      img.src = url;
    });
  }

  async function preloadAll() {
    const promises = images.map(url => preloadImage(url));
    await Promise.all(promises);
    
    // Hide loader and show content with fade-in
    document.querySelector('.imgLoader').style.display = 'none';
    const container = document.querySelector('.container');
    container.style.animation = 'fadeIn 0.5s ease-in forwards';
  }

  // Start preloading when page loads
  window.addEventListener('DOMContentLoaded', preloadAll);

  // Modal để hiển thị ảnh khi click
  const modal = document.getElementById('imageModal');
  const modalImg = document.getElementById('modalImage');
  const closeBtn = document.querySelector('.close');
  const pages = document.querySelectorAll('.page');

  // Khi click vào trang sách
  pages.forEach((page, index) => {
    page.addEventListener('click', function(e) {
      e.stopPropagation(); // Ngăn event bubble
      
      // Sử dụng ảnh từ mảng images đã định nghĩa (ổn định hơn background-image đang animation)
      let imageUrl = '../../img/mockup.jpg'; // Default
      
      if (images && images.length > 0) {
        // Lấy ảnh từ mảng images (có thể dùng index nếu muốn nhiều ảnh khác nhau)
        imageUrl = images[index % images.length];
      } else {
        // Fallback: thử lấy từ background-image
        try {
          const bgImage = window.getComputedStyle(this).backgroundImage;
          const urlMatch = bgImage.match(/url\(["']?([^"']+)["']?\)/);
          if (urlMatch && urlMatch[1]) {
            imageUrl = urlMatch[1];
          }
        } catch (err) {
          console.log('Error getting background image:', err);
        }
      }
      
      // Hiển thị modal với ảnh
      modal.style.display = 'block';
      modalImg.src = imageUrl;
      
      // Đảm bảo ảnh hiển thị
      modalImg.onerror = function() {
        console.log('Error loading image:', imageUrl);
        modalImg.src = '../../img/mockup.jpg'; // Fallback
      };
      
      document.body.style.overflow = 'hidden'; // Prevent background scrolling
    });
  });

  // Đóng modal khi click vào X
  closeBtn.addEventListener('click', function() {
    modal.style.display = 'none';
    document.body.style.overflow = 'auto';
  });

  // Đóng modal khi click bên ngoài ảnh
  modal.addEventListener('click', function(e) {
    if (e.target === modal) {
      modal.style.display = 'none';
      document.body.style.overflow = 'auto';
    }
  });

  // Đóng modal bằng phím ESC
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && modal.style.display === 'block') {
      modal.style.display = 'none';
      document.body.style.overflow = 'auto';
    }
  });
</script>

</body>
</html>